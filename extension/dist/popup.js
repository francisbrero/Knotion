"use strict";(()=>{var c="http://localhost:3000",y=`${c}/api/auth/session`,h=`${c}/api/trpc/link.save`,f=document.getElementById("save-btn"),g=document.getElementById("login-btn"),r=document.getElementById("login-container"),l=document.getElementById("save-container"),a=document.getElementById("status");function n(t,e=!1){a.textContent=t,a.className=e?"status error":"status success",a.style.display="block",setTimeout(()=>{a.style.display="none"},3e3)}async function u(){try{let t=await fetch(y,{method:"GET",credentials:"include"});if(t.ok){let e=await t.json();if(e&&e.user)return r.style.display="none",l.style.display="block",{isAuthenticated:!0,token:e.token}}return r.style.display="block",l.style.display="none",{isAuthenticated:!1}}catch(t){return console.error("Error checking auth status:",t),n("Could not connect to KNotion",!0),{isAuthenticated:!1}}}async function m(t){let s=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0];if(!s||!s.url){n("No active tab found",!0);return}try{let o={json:{url:s.url}},i=await fetch(`${h}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(o)});if(i.ok)n("Page saved successfully! \u2713");else{let d=await i.json();n(`Error: ${d.message||"Failed to save link"}`,!0)}}catch(o){console.error("Error saving link:",o),n("Failed to save link",!0)}}function p(){chrome.tabs.create({url:`${c}/api/auth/signin`})}document.addEventListener("DOMContentLoaded",async()=>{let{isAuthenticated:t,token:e}=await u();f.addEventListener("click",async()=>{let{isAuthenticated:s,token:o}=await u();s?m(o):n("Please log in to KNotion first",!0)}),g.addEventListener("click",p)});})();
