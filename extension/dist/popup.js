"use strict";(()=>{var c="http://localhost:3000",y=`${c}/api/auth/session`,h=`${c}/api/trpc/links.save`,k=document.getElementById("save-btn"),f=document.getElementById("login-btn"),r=document.getElementById("login-container"),l=document.getElementById("save-container"),a=document.getElementById("status");function n(t,e=!1){a.textContent=t,a.className=e?"status error":"status success",a.style.display="block",setTimeout(()=>{a.style.display="none"},3e3)}async function u(){try{let t=await fetch(y,{method:"GET",credentials:"include"});if(t.ok){let e=await t.json();if(e&&e.user)return e.token&&chrome.storage.local.set({knotion_auth_token:e.token}),r.style.display="none",l.style.display="block",{isAuthenticated:!0,token:e.token}}return r.style.display="block",l.style.display="none",{isAuthenticated:!1}}catch(t){return console.error("Error checking auth status:",t),n("Could not connect to KNotion",!0),{isAuthenticated:!1}}}async function g(t){let o=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0];if(!o||!o.url){n("No active tab found",!0);return}try{let s={json:{url:o.url}},i=await fetch(`${h}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)});if(i.ok)n("Page saved successfully! \u2713");else{let d=await i.json();n(`Error: ${d.message||"Failed to save link"}`,!0)}}catch(s){console.error("Error saving link:",s),n("Failed to save link",!0)}}function m(){chrome.tabs.create({url:`${c}/api/auth/signin`})}document.addEventListener("DOMContentLoaded",async()=>{let{isAuthenticated:t,token:e}=await u();k.addEventListener("click",async()=>{let{isAuthenticated:o,token:s}=await u();o?g(s):n("Please log in to KNotion first",!0)}),f.addEventListener("click",m)});})();
